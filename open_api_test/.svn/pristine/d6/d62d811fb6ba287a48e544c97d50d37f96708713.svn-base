package com.xy.api.demo.utils;

import cn.hutool.core.util.XmlUtil;
import cn.hutool.http.HttpUtil;
import com.alibaba.fastjson.JSONObject;

import java.util.HashMap;
import java.util.Map;

/**
 * token 处理器
 *
 * @author maisenlin@mfexcel.com
 * @since 2019-06-21 11:34
 **/
public class TokenUtils {

    /**
     * 获取token
     * @param tokenUrl
     * @param appId
     * @param appSecret
     * @return
     * @throws Exception
     */
    public static String getToken(String tokenUrl, String appId, String appSecret){
        JSONObject jobj = new JSONObject();
        jobj.put("appId", appId);
        jobj.put("appSecret", appSecret);
        String ret = null;
        try {
            ret = HttpUtil.post(tokenUrl, jobj.toJSONString());
        } catch (Exception e) {
            e.printStackTrace();
        }
        /*{
            "code": 200,
            "error": null,
            "message": "459365843081433088"
        }*/
        Map retMap = XmlUtil.xmlToMap(ret);
        if(retMap != null && retMap.get("code").equals("200")){
            return (String) retMap.get("message");
        }
        return null;
    }


    /**
     * 验证token
     * @param tokenUrl
     * @param token
     * @return
     */
    public static String checkToken(String tokenUrl, String token){
        String ret = null;
        Map params = new HashMap();
        params.put("token", token);
        try {
            ret = HttpUtil.get(tokenUrl, params);
            System.out.println(ret);
        } catch (Exception e) {
            e.printStackTrace();
        }
        Map retMap = XmlUtil.xmlToMap(ret);
        if(retMap != null && retMap.get("code").equals("200")){
            return (String) retMap.get("message");
        }
        return null;
    }

}
